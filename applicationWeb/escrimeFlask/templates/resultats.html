{% extends "base.html" %}

{% block linkcss %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/resultats.css')}}">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Average" rel="stylesheet">
<script src="{{ url_for('static',filename='js/updateData.js')}}"> </script>
{% endblock %}

{% block header %}
{% include "partials/_header3.html" %}
{% endblock %}

{% block main %}
<main>
    <div class="petit_titre">
        <h3>Tableau de votre poule :</h3>
        <img class="petite_epee" src="{{url_for('static', filename='images/epeeBleu.png')}}" alt="Epée bleu d'escrime">
    </div>
    <section class="tableau">    
        <table border="0" width="100%" height="100%">
            <tr>
                <th>Nom</th>
                <th>Club</th>
                <th></th>
                {% for i in range(participants|length) %}
                    <th>{{ i+1 }}</th>
                {% endfor %}
                <th></th>
                <th>V</th>
                <th>TD</th>
                <th>TR</th>
                <th>TD-TR</th>
                <th></th>
                <th>Place</th>
            </tr>        
            {% for participant in participants.items() %}
                <tr>
                    <td class="caseBleuClair">{{ participant[1][0] }} {{ participant[1][1] }}</td>
                    <td class="caseBleuClair">{{ participant[1][2] }}</td>
                    <td class="caseBleuFonce">{{ loop.index }}</td>
                    {% for resultat in participant[1][3] %}
                        {% if resultat[1] == -1 %}
                            {% if isArbitre %}
                                <td class="caseBleuClair" contenteditable="true" onblur="updateData(this.innerText, {{participant[0][0]}}, {{resultat[0]}}, {{nbCompet}}, {{1}})"></td>
                            {% else %}
                                <td></td>
                            {% endif %}
                        {% else %}
                            {% if resultat[1] == -2 %}
                                <td class="black"></td>
                            {% else %}
                                {% if isArbitre %}
                                    <td class="caseBleuClair" contenteditable="true" onblur="updateData(this.innerText, {{participant[0][0]}}, {{resultat[0]}}, {{nbCompet}}, {{1}} )">{{resultat[1]}}</td>
                                {% else %}
                                    <td class="caseBleuClair">{{ resultat[1] }}</td>
                                {% endif %}
                            {% endif %}  
                        {% endif %}
                    {% endfor %}
                    <td class="caseBleuFonce"></td>
                    <td class="caseBleuClair">{{ participant[1][6] }}</td>
                    <td class="caseBleuClair">{{ participant[1][4] }}</td>
                    <td class="caseBleuClair">{{ participant[1][5] }}</td>
                    <td class="caseBleuClair">{{participant[1][4] - participant[1][5]}}</td>
                    <td class="caseBleuFonce"></td>
                    <td class="caseRouge">{{participant[1][7]}}</td>
                </tr>
            {% endfor %}

            <tr>
                <td class="caseBleuFonce">Touches Recues</td>
                <td class="caseBleuFonce"></td>
                <td class="caseBleuFonce"></td>
                {% for participant in participants.values() %}
                    <td class="caseBleuClair">{{ participant[5] }}</td>
                {% endfor %}
            </tr>
        </table>
    </section>
    
    <button class="boutonRefresh" onclick="window.location.reload()">Rafraîchir le tableau des scores</button>
    
    <div class="petit_titre">
        <h3>Arbre de phase éliminatoire  :</h3>
        <img class="petite_epee" src="{{url_for('static', filename='images/epeeBleu.png')}}" alt="Epée bleu d'escrime">
    </div>
        <div class="tournament">
        {% if isArbitre %}
            <form action="{{url_for('genererEliminations')}}", method="POST">
                <input type="text" hidden name="nbCompet" value="{{nbCompet}}">
                <input type="text" hidden name="nbLicense" value="{{nbLicense}}">
                <input type="text" hidden name="nbPhase" value="{{nbPhase}}">
                <button class="boutonRefresh" type="submit">Générer les prochaines phases d'eliminations</button>
            </form>   
        {% endif %}
        
        <div class="tournament__grid">
            <!-- tournament__round 1/8 -->
            {% if nbPhase >= 2 %}
                <div class="tournament__round tournament__round--first-round">
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#">{{matchs[0][0][0]}} {{matchs[0][0][1]}}</a>
                    <a class="tournament__match__team" href="#">{{matchs[0][1][0]}} {{matchs[0][1][1]}}</a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#">{{matchs[0][2][0]}} {{matchs[0][2][1]}}</a>
                    <a class="tournament__match__team" href="#">{{matchs[0][3][0]}} {{matchs[0][3][1]}}</a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#">{{matchs[0][4][0]}} {{matchs[0][4][1]}}</a>
                    <a class="tournament__match__team" href="#">{{matchs[0][5][0]}} {{matchs[0][5][1]}}</a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#">{{matchs[0][6][0]}} {{matchs[0][6][1]}}</a>
                    <a class="tournament__match__team" href="#">{{matchs[0][7][0]}} {{matchs[0][7][1]}}</a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#">{{matchs[0][8][0]}} {{matchs[0][8][1]}}</a>
                    <a class="tournament__match__team" href="#">{{matchs[0][9][0]}} {{matchs[0][9][1]}}</a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#">{{matchs[0][10][0]}} {{matchs[0][10][1]}}</a>
                    <a class="tournament__match__team" href="#">{{matchs[0][11][0]}} {{matchs[0][11][1]}}</a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#">{{matchs[0][12][0]}} {{matchs[0][12][1]}}</a>
                    <a class="tournament__match__team" href="#">{{matchs[0][13][0]}} {{matchs[0][13][1]}}</a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#">{{matchs[0][14][0]}} {{matchs[0][14][1]}}</a>
                    <a class="tournament__match__team" href="#">{{matchs[0][15][0]}} {{matchs[0][15][1]}}</a>
                </div>
                </div>
            {% else %}
                <div class="tournament__round tournament__round--first-round">
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#"></a>
                    <a class="tournament__match__team" href="#"></a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#"></a>
                    <a class="tournament__match__team" href="#"></a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#"></a>
                    <a class="tournament__match__team" href="#"></a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#"></a>
                    <a class="tournament__match__team" href="#"></a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#"></a>
                    <a class="tournament__match__team" href="#"></a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#"></a>
                    <a class="tournament__match__team" href="#"></a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#"></a>
                    <a class="tournament__match__team" href="#"></a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#"></a>
                    <a class="tournament__match__team" href="#"></a>
                </div>
                </div>
            {% endif %}
                        
            <!-- tournament__round 1/4 -->
            {% if nbPhase >= 3 %}
                <div class="tournament__round tournament__round--first-round">
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#">{{matchs[1][0][0]}} {{matchs[1][0][1]}}</a>
                    <a class="tournament__match__team" href="#">{{matchs[1][1][0]}} {{matchs[1][1][1]}}</a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#">{{matchs[1][2][0]}} {{matchs[1][2][1]}}</a>
                    <a class="tournament__match__team" href="#">{{matchs[1][3][0]}} {{matchs[1][3][1]}}</a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#">{{matchs[1][4][0]}} {{matchs[1][4][1]}}</a>
                    <a class="tournament__match__team" href="#">{{matchs[1][5][0]}} {{matchs[1][5][1]}}</a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#">{{matchs[1][6][0]}} {{matchs[1][6][1]}}</a>
                    <a class="tournament__match__team" href="#">{{matchs[1][7][0]}} {{matchs[1][7][1]}}</a>
                </div>
                </div>
            {% else %}
                <div class="tournament__round tournament__round--first-round">
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#"></a>
                    <a class="tournament__match__team" href="#"></a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#"></a>
                    <a class="tournament__match__team" href="#"></a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#"></a>
                    <a class="tournament__match__team" href="#"></a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#"></a>
                    <a class="tournament__match__team" href="#"></a>
                </div>
                </div>
            {% endif %}


            <!-- tournament__round 1/2 -->
            {% if nbPhase >= 4 %}
                <div class="tournament__round">
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#">{{matchs[2][0][0]}} {{matchs[2][0][1]}}</a>
                    <a class="tournament__match__team" href="#">{{matchs[2][1][0]}} {{matchs[2][1][1]}}</a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#">{{matchs[2][2][0]}} {{matchs[2][2][1]}}</a>
                    <a class="tournament__match__team" href="#">{{matchs[2][3][0]}} {{matchs[2][3][1]}}</a>
                </div>
                </div>    
            {% else %}
                <div class="tournament__round">
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#"></a>
                    <a class="tournament__match__team" href="#"></a>
                </div>
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#"></a>
                    <a class="tournament__match__team" href="#"></a>
                </div>
                </div>                
            {% endif %}


            <!-- tournament__round final -->
            {% if nbPhase >= 5 %}
                <div class="tournament__round tournament__round--final">
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#">{{matchs[3][0][0]}} {{matchs[3][0][1]}}</a>
                    <a class="tournament__match__team" href="#">{{matchs[3][1][0]}} {{matchs[3][1][1]}}</a>
                </div>
                </div>
            {% else %}
                <div class="tournament__round tournament__round--final">
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#"></a>
                    <a class="tournament__match__team" href="#"></a>
                </div>
                </div>
            {% endif %}
            

            <!-- tournament__round winner -->
            {% if nbPhase >= 5 %}
                <div class="tournament__round tournament__round--winner">
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#">{{matchs[4][0][0]}} {{matchs[4][0][1]}}</a>
                </div>
                </div>
            {% else %}
                <div class="tournament__round tournament__round--winner">
                <div class="tournament__match">
                    <a class="tournament__match__team" href="#"></a>
                </div>
                </div>
            {% endif %}
        </div>
    </div>
    
    
    <div class="petit_titre">
        <h3>Classement  :</h3>
        <img class="petite_epee" src="{{url_for('static', filename='images/epeeBleu.png')}}" alt="Epée bleu d'escrime">    
    </div>
    <div class="classement">
        <table>
            <tr class="titre-tableau">
                <td>RANG</td>
                <td>NOM</td>
                <td>PRÉNOM</td>
                <td>COMITE REGIONAL</td>
                <td>CLUB</td>
                <td>POINTS</td>
            </tr>
            {# <tr>
                <td>{{tireur[8]}}</td>
                <td>{{tireur[0]}}</td>
                <td>{{tireur[1]}}</td>
                <td>{{tireur[5]}}</td>
                <td>{{tireur[6]}}</td>
                <td>{{tireur[7]}}</td>
            </tr> #}
        </table>  

        <table>
            <tr class="titre-tableau">
                <td>RANG</td>
                <td>NOM</td>
                <td>PRÉNOM</td>
                <td>COMITE REGIONAL</td>
                <td>CLUB</td>
                <td>POINTS</td>
            </tr>
            {# {% if classement|length> 0  %}
                {% for joueur in classement %}
                <tr>
                    <td>{{joueur[8]}}</td>
                    <td>{{joueur[0]}}</td>
                    <td>{{joueur[1]}}</td>
                    <td>{{joueur[5]}}</td>
                    <td>{{joueur[6]}}</td>
                    <td>{{joueur[7]}}</td>
                </tr>
                {% endfor %} #}
        </table>  
    </div>
</main>
<script>
    function updateData(value, nbLicenceTireur, nbLicenceTireurAdverse, numCompetition, nbPhase) {
        // Convertir la valeur en nombre
        var numericValue = parseFloat(value);

        // Vérifier si la valeur est un nombre compris entre 0 et 5
        if ( numericValue >= 0 && numericValue <= 5) {
            // Utilisez AJAX pour envoyer la valeur à la fonction Flask
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/update_data", true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    // Traitement de la réponse du serveur si nécessaire
                    console.log(xhr.responseText);
                    // popup pour voir si ça fonctionne
                }
            };
            // Envoyez la valeur et l'index (ou toute autre information nécessaire) à la fonction Flask
            xhr.send("data=" + numericValue + "&nbLicenceTireur=" + nbLicenceTireur + "&nbLicenceTireurAdverse=" + nbLicenceTireurAdverse + "&numCompetition=" + numCompetition + "&nbPhase=" + nbPhase);
            console.log("data=" + numericValue + "&nbLicenceTireur=" + nbLicenceTireur + "&nbLicenceTireurAdverse=" + nbLicenceTireurAdverse + "&numCompetition=" + numCompetition + "&nbPhase=" + nbPhase)
            alert("Le score a été enregistré");

        } else {
            // Afficher un message d'erreur ou réinitialiser la valeur
            alert("Veuillez saisir un nombre entre 0 et 5");
            // Vous pouvez également réinitialiser la valeur à 0, par exemple :
            // document.getElementById("votreID").innerText = 0;
        }
    }
</script>

{% endblock %}
